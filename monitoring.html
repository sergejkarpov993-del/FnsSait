<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî ComplianceRadar</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #0a0a0a;
    --white: #f5f2eb;
    --cream: #ede9de;
    --accent: #c8392b;
    --accent-light: #e8503f;
    --gold: #b8972a;
    --mid: #2a2a2a;
    --gray: #6b6b6b;
    --border: rgba(200,190,170,0.2);
    --green: #4caf7d;
    --API: 'https://fnsbot-production.up.railway.app';
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { scroll-behavior: smooth; }

  body {
    background: var(--black);
    color: var(--white);
    font-family: 'Libre Baskerville', Georgia, serif;
    overflow-x: hidden;
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.4;
  }

  /* NAV */
  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 48px;
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(16px);
    background: rgba(10,10,10,0.85);
  }

  .logo {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--white);
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
  }

  .logo-dot {
    width: 8px; height: 8px;
    background: var(--accent);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.7); }
  }

  .nav-links {
    display: flex;
    gap: 40px;
    list-style: none;
  }

  .nav-links a {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--gray);
    text-decoration: none;
    transition: color 0.2s;
  }

  .nav-links a:hover { color: var(--white); }
  .nav-links a.active { color: var(--white); }

  .nav-cta {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--black);
    background: var(--white);
    padding: 10px 20px;
    text-decoration: none;
    transition: background 0.2s, color 0.2s;
  }

  .nav-cta:hover { background: var(--accent); color: var(--white); }

  /* BURGER */
  .burger {
    display: none;
    flex-direction: column;
    gap: 5px;
    cursor: pointer;
    padding: 4px;
    background: none;
    border: none;
    z-index: 200;
  }
  .burger span {
    display: block; width: 24px; height: 2px;
    background: var(--white); transition: all 0.3s ease; transform-origin: center;
  }
  .burger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
  .burger.open span:nth-child(2) { opacity: 0; transform: scaleX(0); }
  .burger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

  .mobile-menu {
    display: none;
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(10,10,10,0.98);
    z-index: 150;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(20px);
  }
  .mobile-menu.open { display: flex; }
  .mobile-menu a {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(28px, 7vw, 40px);
    font-weight: 700;
    color: var(--white);
    text-decoration: none;
    padding: 20px 40px;
    width: 100%;
    text-align: center;
    border-bottom: 1px solid var(--border);
    transition: color 0.2s;
  }
  .mobile-menu a:first-child { border-top: 1px solid var(--border); }
  .mobile-menu a:hover { color: var(--gold); }

  /* PAGE HEADER */
  .page-header {
    padding: 140px 48px 60px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 24px;
    background: linear-gradient(180deg, rgba(17,17,17,0.5) 0%, transparent 100%);
  }

  .page-header-left {}

  .page-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .page-tag::before {
    content: '';
    display: inline-block;
    width: 24px; height: 1px;
    background: var(--gold);
  }

  .page-title {
    font-family: 'Libre Baskerville', Georgia, serif;
    font-size: clamp(32px, 4vw, 52px);
    line-height: 1.1;
    font-weight: 700;
  }

  /* STATUS INDICATOR */
  .status-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--gray);
  }

  .status-dot.online { background: var(--green); animation: pulse 2s ease-in-out infinite; }
  .status-dot.error { background: var(--accent); }

  /* MAIN CONTENT */
  .main {
    padding: 48px 48px 80px;
    display: flex;
    flex-direction: column;
    gap: 48px;
  }

  /* STATS ROW */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
  }

  .stat-card {
    background: #0f0f0f;
    padding: 32px 28px;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--gold);
    transform: scaleX(0);
    transition: transform 0.3s ease;
    transform-origin: left;
  }

  .stat-card:hover::before { transform: scaleX(1); }

  .stat-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--gray);
    margin-bottom: 12px;
  }

  .stat-value {
    font-size: 42px;
    font-weight: 700;
    line-height: 1;
    color: var(--gold);
    margin-bottom: 6px;
  }

  .stat-sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: rgba(107,107,107,0.6);
    letter-spacing: 0.08em;
  }

  .stat-skeleton {
    height: 42px;
    background: rgba(255,255,255,0.04);
    border-radius: 2px;
    animation: shimmer 1.5s infinite;
    margin-bottom: 6px;
  }

  @keyframes shimmer {
    0% { opacity: 0.5; }
    50% { opacity: 1; }
    100% { opacity: 0.5; }
  }

  /* CONTROLS */
  .controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 16px;
  }

  .filters {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .filter-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 8px 16px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--gray);
    cursor: pointer;
    transition: all 0.2s;
  }

  .filter-btn:hover, .filter-btn.active {
    border-color: var(--white);
    color: var(--white);
    background: rgba(255,255,255,0.04);
  }

  .filter-btn.urgent.active {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(200,57,43,0.08);
  }

  .action-btns {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .btn-parse {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 10px 20px;
    background: var(--accent);
    color: var(--white);
    border: none;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .btn-parse:hover { background: var(--accent-light); transform: translateY(-1px); }
  .btn-parse:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-refresh {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 10px 20px;
    background: transparent;
    color: var(--white);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .btn-refresh:hover { border-color: var(--white); background: rgba(255,255,255,0.04); }

  .spin { animation: spin 1s linear infinite; }
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  /* DOCUMENTS TABLE */
  .docs-section {}

  .docs-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 0 20px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 0;
  }

  .docs-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--gray);
  }

  .docs-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.08em;
    color: var(--gray);
  }

  /* DOCUMENT CARDS */
  .doc-list {
    display: flex;
    flex-direction: column;
  }

  .doc-card {
    border-bottom: 1px solid var(--border);
    padding: 28px 0;
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 24px;
    align-items: start;
    transition: background 0.2s;
    cursor: default;
  }

  .doc-card:hover { background: rgba(255,255,255,0.015); margin: 0 -48px; padding-left: 48px; padding-right: 48px; }

  .doc-index {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: rgba(107,107,107,0.4);
    letter-spacing: 0.08em;
    min-width: 28px;
    padding-top: 3px;
  }

  .doc-body {}

  .doc-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  .doc-source {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--gold);
    border: 1px solid rgba(184,151,42,0.3);
    padding: 2px 8px;
  }

  .doc-date {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--gray);
    letter-spacing: 0.06em;
  }

  .doc-urgent {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--accent);
    background: rgba(200,57,43,0.1);
    border: 1px solid rgba(200,57,43,0.3);
    padding: 2px 8px;
    animation: urgentPulse 2s ease-in-out infinite;
  }

  @keyframes urgentPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .doc-title {
    font-family: 'Libre Baskerville', Georgia, serif;
    font-size: 17px;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 8px;
    color: var(--white);
  }

  .doc-summary {
    font-size: 14px;
    line-height: 1.65;
    color: rgba(245,242,235,0.65);
    max-width: 720px;
  }

  .doc-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 12px;
  }

  .doc-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.06em;
    color: rgba(184,151,42,0.7);
    border: 1px solid rgba(184,151,42,0.2);
    padding: 2px 8px;
  }

  .doc-link {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--gray);
    text-decoration: none;
    border: 1px solid var(--border);
    padding: 8px 14px;
    transition: all 0.2s;
    white-space: nowrap;
    align-self: flex-start;
  }

  .doc-link:hover { border-color: var(--white); color: var(--white); }

  /* SKELETON CARD */
  .doc-skeleton {
    border-bottom: 1px solid var(--border);
    padding: 28px 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .sk-line {
    height: 12px;
    background: rgba(255,255,255,0.04);
    border-radius: 2px;
    animation: shimmer 1.5s infinite;
  }

  .sk-title { height: 20px; width: 70%; }
  .sk-summary { width: 90%; }
  .sk-summary2 { width: 60%; }

  /* EMPTY STATE */
  .empty-state {
    padding: 80px 0;
    text-align: center;
    border-bottom: 1px solid var(--border);
  }

  .empty-icon {
    font-size: 48px;
    margin-bottom: 20px;
    opacity: 0.3;
  }

  .empty-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 10px;
    color: rgba(245,242,235,0.4);
  }

  .empty-sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: rgba(107,107,107,0.5);
    letter-spacing: 0.08em;
  }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 32px;
    right: 32px;
    z-index: 1000;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    letter-spacing: 0.08em;
    padding: 16px 24px;
    border: 1px solid var(--border);
    backdrop-filter: blur(16px);
    background: rgba(20,20,20,0.95);
    color: var(--white);
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s ease;
    max-width: 340px;
  }

  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.success { border-color: rgba(76,175,125,0.5); }
  .toast.error { border-color: rgba(200,57,43,0.5); }

  /* SOURCES BREAKDOWN */
  .sources-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
  }

  .source-stat {
    background: #0a0a0a;
    padding: 24px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .source-name {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    color: var(--gray);
  }

  .source-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 22px;
    font-weight: 500;
    color: var(--white);
  }

  /* ‚îÄ‚îÄ FILTER BAR (–Ω–æ–≤—ã–π) ‚îÄ‚îÄ */
  .filter-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 0;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    flex-wrap: wrap;
  }

  .filter-bar .filter-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.18em;
    color: var(--gray);
    text-transform: uppercase;
    white-space: nowrap;
    margin-right: 4px;
  }

  .filter-bar .select-wrapper {
    position: relative;
  }

  .filter-bar .select-wrapper::after {
    content: '‚ñæ';
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
    font-size: 10px;
    pointer-events: none;
  }

  .filter-bar select {
    appearance: none;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    color: var(--white);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 8px 32px 8px 14px;
    cursor: pointer;
    outline: none;
    transition: border-color 0.15s, color 0.15s;
    min-width: 160px;
  }

  .filter-bar select option {
    background: #1a1a1a;
    color: var(--white);
  }

  .filter-bar select:hover { border-color: rgba(200,190,170,0.4); }
  .filter-bar select:focus { border-color: var(--accent); }

  .sort-toggle {
    display: flex;
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .sort-btn {
    background: rgba(255,255,255,0.02);
    border: none;
    color: var(--gray);
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 8px 16px;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }

  .sort-btn + .sort-btn { border-left: 1px solid var(--border); }
  .sort-btn:hover { background: rgba(255,255,255,0.05); color: var(--white); }

  .sort-btn.active {
    background: rgba(200,57,43,0.08);
    color: var(--accent);
    box-shadow: inset 0 0 0 1px rgba(200,57,43,0.25);
  }

  .filter-bar .bar-divider {
    width: 1px;
    height: 24px;
    background: var(--border);
    margin: 0 4px;
  }

  .filter-bar .bar-actions {
    margin-left: auto;
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .filter-bar .filter-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* site dropdown */
  .site-dropdown-btn {
    appearance: none;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    color: var(--white);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 8px 14px;
    cursor: pointer;
    min-width: 160px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: border-color 0.15s;
  }
  .site-dropdown-btn:hover { border-color: rgba(200,190,170,0.4); }

  .site-dropdown-menu {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    z-index: 200;
    background: #161616;
    border: 1px solid var(--border);
    min-width: 200px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }

  .site-option {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--gray);
    padding: 10px 16px;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .site-option:hover { background: rgba(255,255,255,0.04); color: var(--white); }
  .site-option.selected { color: var(--accent); }
  .site-option.selected::after { content: "‚úì"; font-size: 11px; }

  /* pills */
  .active-filters {
    display: flex;
    gap: 6px;
    margin-top: 10px;
    flex-wrap: wrap;
    min-height: 24px;
  }

  .pill {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    color: var(--gray);
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 4px 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    animation: fadeIn 0.2s ease;
  }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: none; } }

  .pill .pill-x {
    color: var(--gray);
    cursor: pointer;
    font-size: 11px;
    line-height: 1;
    transition: color 0.1s;
  }

  .pill .pill-x:hover { color: var(--accent); }

  /* LOAD MORE */
  .load-more-wrap {
    display: flex;
    justify-content: center;
    padding: 40px 0;
  }

  .btn-load-more {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 14px 32px;
    background: transparent;
    color: var(--gray);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-load-more:hover { color: var(--white); border-color: var(--white); }
  .btn-load-more:disabled { opacity: 0.4; cursor: not-allowed; }

  /* FOOTER */
  footer {
    border-top: 1px solid var(--border);
    padding: 40px 48px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #050505;
  }

  .footer-logo {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--gray);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .footer-copy {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: rgba(107,107,107,0.5);
    letter-spacing: 0.08em;
  }

  .footer-links {
    display: flex;
    gap: 32px;
  }

  .footer-links a {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--gray);
    text-decoration: none;
    letter-spacing: 0.08em;
    transition: color 0.2s;
  }

  .footer-links a:hover { color: var(--white); }

  /* RESPONSIVE */
  @media (max-width: 900px) {
    nav { padding: 20px 24px; }
    .nav-links, .nav-cta { display: none; }
    .burger { display: flex; }
    .page-header { padding: 120px 24px 48px; }
    .main { padding: 32px 24px 60px; }
    .stats-row { grid-template-columns: 1fr 1fr; }
    .sources-row { grid-template-columns: 1fr; }
    .doc-card { grid-template-columns: 1fr; gap: 12px; }
    .doc-card:hover { margin: 0; padding-left: 0; padding-right: 0; }
    .doc-index { display: none; }
    footer { flex-direction: column; gap: 20px; text-align: center; padding: 32px 24px; }
    .footer-links { flex-wrap: wrap; justify-content: center; gap: 16px; }
  }

  @media (max-width: 600px) {
    .stats-row { grid-template-columns: 1fr; }
    .controls { flex-direction: column; align-items: flex-start; }
    .action-btns { width: 100%; }
    .btn-parse, .btn-refresh { flex: 1; justify-content: center; }
  }

  
  /* ‚îÄ‚îÄ SOURCES PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .sources-panel {
    border: 1px solid var(--border);
    background: #080808;
    margin-bottom: 0;
  }
  .sources-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 28px;
    border-bottom: 1px solid var(--border);
  }
  .sources-panel-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--white);
  }
  .sources-panel-sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    color: var(--gray);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .sources-panel-sub::before {
    content: '';
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--green);
    animation: pulse 2s ease-in-out infinite;
  }
  .sources-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--border);
  }
  .source-card {
    background: #0a0a0a;
    padding: 22px 24px;
    text-decoration: none;
    color: var(--white);
    transition: background 0.2s;
    display: flex;
    flex-direction: column;
    gap: 8px;
    cursor: pointer;
  }
  .source-card:hover { background: #0f0f0f; }
  .source-card-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  .source-icon {  line-height: 1; }
  .source-count-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 18px;
    font-weight: 500;
    color: var(--gold);
    line-height: 1;
  }
  .source-card-name {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.08em;
    color: var(--white);
    margin-top: 4px;
  }
  .source-card-desc {
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    line-height: 1.5;
    color: rgba(245,242,235,0.45);
  }
  .source-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 4px;
  }
  .src-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 0.06em;
    padding: 3px 7px;
    border: 1px solid var(--border);
    color: var(--gray);
  }
  @media (max-width: 900px) { .sources-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 500px) { .sources-grid { grid-template-columns: 1fr; } }


  /* ‚îÄ‚îÄ –ü–ï–†–ï–•–û–î–´ –ú–ï–ñ–î–£ –°–¢–†–ê–ù–ò–¶–ê–ú–ò ‚îÄ‚îÄ */
  body { opacity: 1; transition: opacity 0.25s ease; }
  body.page-exit { opacity: 0; }


  /* ‚îÄ‚îÄ SEARCH BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .search-bar {
    display: flex;
    align-items: center;
    gap: 0;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.02);
    transition: border-color 0.2s;
  }
  .search-bar:focus-within {
    border-color: rgba(200,190,170,0.4);
  }
  .search-bar-icon {
    padding: 0 14px;
    color: var(--gray);
    font-size: 14px;
    line-height: 1;
    pointer-events: none;
  }
  .search-bar input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--white);
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    padding: 12px 0;
    letter-spacing: 0;
  }
  .search-bar input::placeholder {
    color: var(--gray);
    font-size: 13px;
  }
  .search-bar .search-kbd {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: rgba(107,107,107,0.5);
    padding: 0 14px;
    letter-spacing: 0.06em;
    white-space: nowrap;
  }
  .search-results-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--gray);
    letter-spacing: 0.08em;
    margin-top: 8px;
    min-height: 16px;
  }

  /* ‚îÄ‚îÄ INDUSTRY FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .industry-section {
    border: 1px solid var(--border);
    background: #080808;
  }
  .industry-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
  }
  .industry-section-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--white);
  }
  .industry-reset {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    color: var(--gray);
    cursor: pointer;
    background: none;
    border: none;
    text-transform: uppercase;
    transition: color 0.15s;
  }
  .industry-reset:hover { color: var(--accent); }
  .industry-grid-ui {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--border);
  }
  .industry-btn-ui {
    background: #0a0a0a;
    border: none;
    color: var(--gray);
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 16px 14px;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
    text-align: left;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .industry-btn-ui:hover {
    background: #0f0f0f;
    color: var(--white);
  }
  .industry-btn-ui.active {
    background: rgba(184,151,42,0.08);
    color: var(--gold);
  }
  .industry-btn-ui.active::after {
    content: '‚úì';
    font-size: 10px;
    color: var(--gold);
  }
  .industry-icon { font-size: 24px; margin-bottom: 4px; display: block; }
  .ind-name { font-size: 11px; letter-spacing: 0.08em; }
  .ind-count {
    font-size: 16px;
    font-weight: 500;
    color: var(--white);
    font-family: 'JetBrains Mono', monospace;
  }
  .industry-btn-ui.active .ind-count { color: var(--gold); }
  @media (max-width: 900px) { .industry-grid-ui { grid-template-columns: repeat(2, 1fr); } }

  /* ‚îÄ‚îÄ CALENDAR SECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .calendar-section {
    border: 1px solid var(--border);
    background: #080808;
  }
  .calendar-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
  }
  .calendar-section-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--white);
  }
  .cal-nav {
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .cal-nav-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--gray);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    width: 28px; height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.15s;
  }
  .cal-nav-btn:hover { border-color: var(--white); color: var(--white); }
  .cal-month-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.1em;
    color: var(--gray);
    text-transform: uppercase;
    min-width: 100px;
    text-align: center;
  }
  .cal-body {
    padding: 20px 24px;
  }
  .cal-grid-ui {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
  }
  .cal-day-name-ui {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: rgba(107,107,107,0.5);
    text-align: center;
    padding: 6px 0;
  }
  .cal-day-ui {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--gray);
    position: relative;
    cursor: pointer;
    transition: all 0.15s;
  }
  .cal-day-ui:hover:not(.empty) {
    color: var(--white);
    background: rgba(255,255,255,0.04);
  }
  .cal-day-ui.today {
    color: var(--white);
    font-weight: 700;
  }
  .cal-day-ui.today::before {
    content: '';
    position: absolute;
    inset: 2px;
    border: 1px solid rgba(200,190,170,0.25);
  }
  .cal-day-ui.has-event::after {
    content: '';
    position: absolute;
    bottom: 3px; left: 50%;
    transform: translateX(-50%);
    width: 3px; height: 3px;
    border-radius: 50%;
    background: var(--gold);
  }
  .cal-day-ui.has-urgent::after { background: var(--accent); }
  .cal-day-ui.empty { pointer-events: none; }

  /* Upcoming list */
  .upcoming-section {
    border: 1px solid var(--border);
    background: #080808;
  }
  .upcoming-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
  }
  .upcoming-section-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--white);
  }
  .upcoming-list-ui {
    display: flex;
    flex-direction: column;
  }
  .upcoming-item-ui {
    display: grid;
    grid-template-columns: 52px 1fr;
    gap: 16px;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    align-items: center;
    cursor: pointer;
    transition: background 0.15s;
  }
  .upcoming-item-ui:last-child { border-bottom: none; }
  .upcoming-item-ui:hover { background: rgba(255,255,255,0.02); }
  .upcoming-date-ui {
    display: flex;
    flex-direction: column;
    align-items: center;
    border: 1px solid var(--border);
    padding: 8px 4px;
  }
  .upcoming-date-ui .ud-day {
    font-family: 'JetBrains Mono', monospace;
    font-size: 20px;
    font-weight: 500;
    color: var(--gold);
    line-height: 1;
  }
  .upcoming-date-ui .ud-day.urgent { color: var(--accent); }
  .upcoming-date-ui .ud-month {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--gray);
    margin-top: 2px;
  }
  .upcoming-info-ui {}
  .upcoming-title-ui {
    font-size: 13px;
    font-weight: 500;
    line-height: 1.4;
    color: var(--white);
    margin-bottom: 4px;
    font-family: 'Inter', sans-serif;
  }
  .upcoming-source-ui {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.06em;
    color: var(--gray);
  }
  .upcoming-empty {
    padding: 32px 24px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: rgba(107,107,107,0.4);
    letter-spacing: 0.08em;
    text-align: center;
  }

  /* doc-card eff-date inline */
  .doc-eff-date {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.06em;
    color: var(--gray);
    display: inline-flex;
    align-items: center;
    gap: 5px;
    border: 1px solid var(--border);
    padding: 2px 8px;
  }
  .doc-eff-date.soon { color: var(--accent); border-color: rgba(200,57,43,0.3); background: rgba(200,57,43,0.06); }

  @media (max-width: 900px) {
    .industry-grid-ui { grid-template-columns: repeat(2, 1fr); }
  }


  /* ‚îÄ‚îÄ –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–µ ‚îÄ‚îÄ */
  /* –ó–∞–≥–æ–ª–æ–≤–∫–∏: Libre Baskerville */
  .page-title, .doc-title, h1, h2, h3 {
    font-family: 'Libre Baskerville', Georgia, serif;
  }
  /* –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç: Inter */
  .doc-summary, .source-card-desc, .upcoming-title-ui, p {
    font-family: 'Inter', system-ui, sans-serif;
    font-size: 14px;
    line-height: 1.65;
  }
  /* –ú–µ—Ç–∫–∏, —Ç–µ–≥–∏, –∫–Ω–æ–ø–∫–∏, –≤—Å—ë —Å–ª—É–∂–µ–±–Ω–æ–µ: JetBrains Mono */
  .doc-source, .doc-date, .doc-urgent, .doc-tag, .doc-link,
  .stat-label, .stat-sub, .filter-btn, .sort-btn,
  .site-dropdown-btn, .site-option, .pill, .btn-parse, .btn-refresh, .btn-load-more,
  .docs-title, .docs-count, .page-tag, .status-indicator,
  .sources-panel-title, .sources-panel-sub, .source-card-name,
  .src-tag, .footer-logo, .footer-copy, .footer-links a,
  .filter-label, .filter-bar, .industry-section-title, .ind-name,
  .calendar-section-title, .cal-month-label, .cal-day-name-ui, .cal-day-ui,
  .upcoming-section-title, .upcoming-source-ui,
  .search-results-count, .search-kbd, .industry-reset,
  .cal-nav-btn, .sources-panel-sub {
    font-family: 'JetBrains Mono', monospace;
  }
  /* doc-title —Ä–∞–∑–º–µ—Ä */
  .doc-title { font-size: 17px; font-weight: 700; line-height: 1.3; }
  /* stat-value —Ä–∞–∑–º–µ—Ä */  
  .stat-value { font-family: 'Libre Baskerville', Georgia, serif; }
  /* search input */
  .search-bar input {
    font-family: 'Inter', system-ui, sans-serif;
    font-size: 14px;
  }

</style>
</head>
<body>

<!-- NAV -->
<nav>
  <a href="index.html" class="logo">
    <span class="logo-dot"></span>
    ComplianceRadar
  </a>
  <ul class="nav-links">
    <li><a href="product.html">–ü—Ä–æ–¥—É–∫—Ç</a></li>
    <li><a href="industries.html">–û—Ç—Ä–∞—Å–ª–∏</a></li>
    <li><a href="index.html#pricing">–¢–∞—Ä–∏—Ñ—ã</a></li>
    <li><a href="monitoring.html" class="active">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a></li>
    <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
  </ul>
  <div id="userPanel" style="display:none;font-family:JetBrains Mono,monospace;font-size:11px;letter-spacing:.08em;display:flex;align-items:center;gap:16px;"><span id="userName" style="color:var(--gray)"></span><button onclick="logout()" style="background:transparent;border:1px solid var(--border);color:var(--gray);font-family:JetBrains Mono,monospace;font-size:11px;letter-spacing:.08em;padding:8px 14px;cursor:pointer;transition:all .2s" onmouseover="this.style.color='var(--white)';this.style.borderColor='var(--white)'" onmouseout="this.style.color='var(--gray)';this.style.borderColor='var(--border)'">–í—ã–π—Ç–∏</button></div>
  <button class="burger" id="burger" aria-label="–ú–µ–Ω—é">
    <span></span><span></span><span></span>
  </button>
</nav>

<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobileMenu">
  <a href="product.html">–ü—Ä–æ–¥—É–∫—Ç</a>
  <a href="industries.html">–û—Ç—Ä–∞—Å–ª–∏</a>
  <a href="index.html#pricing">–¢–∞—Ä–∏—Ñ—ã</a>
  <a href="monitoring.html">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
  <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
</div>

<!-- PAGE HEADER -->
<div class="page-header">
  <div class="page-header-left">
    <div class="page-tag">Live</div>
    <h1 class="page-title">–õ–µ–Ω—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h1>
  </div>
  <div class="status-indicator">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText" style="color:var(--gray);">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
  </div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- STATS -->
  <div class="stats-row" id="statsRow">
    <div class="stat-card">
      <div class="stat-label">–í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>
      <div class="stat-skeleton" id="skTotal"></div>
      <div class="stat-value" id="statTotal" style="display:none"></div>
      <div class="stat-sub">–≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ Claude</div>
      <div class="stat-skeleton" id="skProcessed"></div>
      <div class="stat-value" id="statProcessed" style="display:none"></div>
      <div class="stat-sub">–ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">–°—Ä–æ—á–Ω—ã—Ö</div>
      <div class="stat-skeleton" id="skUrgent"></div>
      <div class="stat-value" id="statUrgent" style="display:none" style="color:var(--accent)"></div>
      <div class="stat-sub">–≤—Å—Ç—É–ø–∞—é—Ç –≤ —Å–∏–ª—É &lt;30 –¥–Ω–µ–π</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
      <div class="stat-skeleton" id="skSubs"></div>
      <div class="stat-value" id="statSubs" style="display:none"></div>
      <div class="stat-sub">–∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
    </div>
  </div>


  <!-- SEARCH BAR -->
  <div>
    <div class="search-bar">
      <span class="search-bar-icon">‚åï</span>
      <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É, —Ç–µ–∫—Å—Ç—É, –Ω–æ–º–µ—Ä—É –∑–∞–∫–æ–Ω–∞, —Ç–µ–≥—É..." autocomplete="off">
      <span class="search-kbd">/ –¥–ª—è –ø–æ–∏—Å–∫–∞</span>
    </div>
    <div class="search-results-count" id="searchResultsCount"></div>
  </div>

  <!-- SOURCES PANEL -->
  <div class="sources-panel">
    <div class="sources-panel-header">
      <span class="sources-panel-title">–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</span>
      <span class="sources-panel-sub">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞</span>
    </div>
    <div class="sources-grid">

      <a href="https://publication.pravo.gov.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><path d="M12 3v18M3 9h18M5 6l14 12M19 6L5 18"/></svg></div>
          <div class="source-count-badge" id="srcPravo">‚Äî</div>
        </div>
        <div class="source-card-name">pravo.gov.ru</div>
        <div class="source-card-desc">–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –∑–∞–∫–æ–Ω—ã, —É–∫–∞–∑—ã –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞, –ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞</div>
        <div class="source-card-tags">
          <span class="src-tag">–£–∫–∞–∑—ã –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞</span>
          <span class="src-tag">–ü–æ—Å—Ç. –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞</span>
          <span class="src-tag">–§–ó</span>
        </div>
      </a>

      <a href="https://www.nalog.gov.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><rect x="5" y="2" width="14" height="20" rx="2"/><path d="M9 7h6M9 11h6M9 15h4"/></svg></div>
          <div class="source-count-badge" id="srcNalog">‚Äî</div>
        </div>
        <div class="source-card-name">nalog.gov.ru</div>
        <div class="source-card-desc">–ü—Ä–∏–∫–∞–∑—ã, –ø–∏—Å—å–º–∞, —Ä–∞–∑—ä—è—Å–Ω–µ–Ω–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç—ã –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –§–ù–° –†–æ—Å—Å–∏–∏</div>
        <div class="source-card-tags">
          <span class="src-tag">–ü—Ä–∏–∫–∞–∑—ã –§–ù–°</span>
          <span class="src-tag">–ü–∏—Å—å–º–∞</span>
          <span class="src-tag">–û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å</span>
        </div>
      </a>

      <a href="https://www.cbr.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><path d="M3 21h18M3 10h18M5 6l7-3 7 3M4 10v11M20 10v11M8 10v11M12 10v11M16 10v11"/></svg></div>
          <div class="source-count-badge" id="srcCbr">‚Äî</div>
        </div>
        <div class="source-card-name">cbr.ru</div>
        <div class="source-card-desc">–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∞–∫—Ç—ã, –ø—Ä–µ—Å—Å-—Ä–µ–ª–∏–∑—ã –∏ —Ä–µ—à–µ–Ω–∏—è –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏</div>
        <div class="source-card-tags">
          <span class="src-tag">–ù–æ—Ä–º–∞—Ç–∏–≤—ã</span>
          <span class="src-tag">–°—Ç–∞–≤–∫–∞ –¶–ë</span>
          <span class="src-tag">–ü—Ä–µ–¥–ø–∏—Å–∞–Ω–∏—è</span>
        </div>
      </a>

      <a href="https://rg.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><path d="M4 22V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v16l-4-2-4 2-4-2-4 2z"/><path d="M9 9h6M9 13h6M9 17h4"/></svg></div>
          <div class="source-count-badge">RSS</div>
        </div>
        <div class="source-card-name">rg.ru</div>
        <div class="source-card-desc">–†–æ—Å—Å–∏–π—Å–∫–∞—è –ì–∞–∑–µ—Ç–∞ ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–æ–Ω–æ–≤ –†–§</div>
        <div class="source-card-tags">
          <span class="src-tag">–ó–∞–∫–æ–Ω—ã –†–§</span>
          <span class="src-tag">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π</span>
        </div>
      </a>

      <a href="https://www.consultant.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><rect x="8" y="2" width="8" height="4" rx="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M9 12h6M9 16h4"/></svg></div>
          <div class="source-count-badge">RSS</div>
        </div>
        <div class="source-card-name">consultant.ru</div>
        <div class="source-card-desc">–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–ü–ª—é—Å ‚Äî –≥–æ—Ä—è—á–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞</div>
        <div class="source-card-tags">
          <span class="src-tag">–ì–æ—Ä—è—á–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</span>
          <span class="src-tag">–ù–ü–ê</span>
        </div>
      </a>

      <a href="https://minfin.gov.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><rect x="2" y="6" width="20" height="12" rx="2"/><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0-6 0"/><path d="M6 12h.01M18 12h.01"/></svg></div>
          <div class="source-count-badge">RSS</div>
        </div>
        <div class="source-card-name">minfin.gov.ru</div>
        <div class="source-card-desc">–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –§–°–ë–£, –ø–∏—Å—å–º–∞ –ø–æ –±—É—Ö—É—á—ë—Ç—É, –Ω–∞–ª–æ–≥–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞</div>
        <div class="source-card-tags">
          <span class="src-tag">–§–°–ë–£</span>
          <span class="src-tag">–ë—É—Ö—É—á—ë—Ç</span>
          <span class="src-tag">–ù–∞–ª–æ–≥–∏</span>
        </div>
      </a>

      <a href="https://mintrud.gov.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><path d="M2 20h20M12 2v4M4.93 7.93A9.97 9.97 0 0 0 2 14h20a9.97 9.97 0 0 0-2.93-6.07"/><path d="M7 14v-4a5 5 0 0 1 10 0v4"/></svg></div>
          <div class="source-count-badge">RSS</div>
        </div>
        <div class="source-card-name">mintrud.gov.ru</div>
        <div class="source-card-desc">–ú–∏–Ω—Ç—Ä—É–¥ –†–æ—Å—Å–∏–∏ ‚Äî —Ç—Ä—É–¥–æ–≤–æ–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –æ—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞</div>
        <div class="source-card-tags">
          <span class="src-tag">–¢–ö –†–§</span>
          <span class="src-tag">–û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞</span>
        </div>
      </a>

      <a href="https://rospotrebnadzor.ru" target="_blank" class="source-card">
        <div class="source-card-top">
          <div class="source-icon"><svg viewBox="0 0 24 24" style="width:26px;height:26px;stroke:var(--gold);fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round"><path d="M6 18l6-12 6 12"/><path d="M9 12h6"/></svg></div>
          <div class="source-count-badge">RSS</div>
        </div>
        <div class="source-card-name">rospotrebnadzor.ru</div>
        <div class="source-card-desc">–†–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä ‚Äî —Å–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ –Ω–æ—Ä–º—ã, –∑–∞—â–∏—Ç–∞ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π</div>
        <div class="source-card-tags">
          <span class="src-tag">–°–∞–Ω–ü–∏–ù</span>
          <span class="src-tag">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</span>
        </div>
      </a>

    </div>
  </div>

  <!-- INDUSTRY FILTER -->
  <div class="industry-section">
    <div class="industry-section-header">
      <span class="industry-section-title">–§–∏–ª—å—Ç—Ä –ø–æ –æ—Ç—Ä–∞—Å–ª–∏</span>
      <button class="industry-reset" onclick="resetIndustry()">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
    <div class="industry-grid-ui" id="industryGrid">
      <button class="industry-btn-ui" data-industry="all" onclick="setIndustry('all',this)">
        <span class="industry-icon">‚óà</span>
        <span class="ind-name">–í—Å–µ –æ—Ç—Ä–∞—Å–ª–∏</span>
        <span class="ind-count" id="indCountAll">‚Äî</span>
      </button>
      <button class="industry-btn-ui" data-industry="tax" onclick="setIndustry('tax',this)">
        <span class="industry-icon">üìä</span>
        <span class="ind-name">–ù–∞–ª–æ–≥–∏ –∏ —É—á—ë—Ç</span>
        <span class="ind-count" id="indCountTax">‚Äî</span>
      </button>
      <button class="industry-btn-ui" data-industry="bank" onclick="setIndustry('bank',this)">
        <span class="industry-icon">üè¶</span>
        <span class="ind-name">–ë–∞–Ω–∫–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã</span>
        <span class="ind-count" id="indCountBank">‚Äî</span>
      </button>
      <button class="industry-btn-ui" data-industry="it" onclick="setIndustry('it',this)">
        <span class="industry-icon">üì°</span>
        <span class="ind-name">IT –∏ –¥–∞–Ω–Ω—ã–µ</span>
        <span class="ind-count" id="indCountIt">‚Äî</span>
      </button>
      <button class="industry-btn-ui" data-industry="labor" onclick="setIndustry('labor',this)">
        <span class="industry-icon">üõ°</span>
        <span class="ind-name">–¢—Ä—É–¥ –∏ –∫–∞–¥—Ä—ã</span>
        <span class="ind-count" id="indCountLabor">‚Äî</span>
      </button>
      <button class="industry-btn-ui" data-industry="trade" onclick="setIndustry('trade',this)">
        <span class="industry-icon">üõí</span>
        <span class="ind-name">–†–∏—Ç–µ–π–ª –∏ —Ç–æ—Ä–≥–æ–≤–ª—è</span>
        <span class="ind-count" id="indCountTrade">‚Äî</span>
      </button>
      <button class="industry-btn-ui" data-industry="construction" onclick="setIndustry('construction',this)">
        <span class="industry-icon">üèó</span>
        <span class="ind-name">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</span>
        <span class="ind-count" id="indCountConst">‚Äî</span>
      </button>
      <button class="industry-btn-ui" data-industry="pharma" onclick="setIndustry('pharma',this)">
        <span class="industry-icon">üíä</span>
        <span class="ind-name">–ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ —Ñ–∞—Ä–º–∞</span>
        <span class="ind-count" id="indCountPharma">‚Äî</span>
      </button>
    </div>
  </div>

  <!-- CALENDAR + UPCOMING -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:1px;background:var(--border);">

    <!-- CALENDAR -->
    <div class="calendar-section">
      <div class="calendar-section-header">
        <span class="calendar-section-title">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É</span>
        <div class="cal-nav">
          <button class="cal-nav-btn" onclick="calPrev()">‚Äπ</button>
          <span class="cal-month-label" id="calMonthLabel"></span>
          <button class="cal-nav-btn" onclick="calNext()">‚Ä∫</button>
        </div>
      </div>
      <div class="cal-body">
        <div class="cal-grid-ui" id="calGrid"></div>
      </div>
    </div>

    <!-- UPCOMING -->
    <div class="upcoming-section">
      <div class="upcoming-section-header">
        <span class="upcoming-section-title">–ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã</span>
      </div>
      <div class="upcoming-list-ui" id="upcomingList">
        <div class="upcoming-empty">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </div>

  </div>

  <!-- FILTER BAR -->
  <div>
    <div class="filter-bar">

      <!-- –°–∞–π—Ç (–º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä) -->
      <div class="filter-group" style="position:relative;">
        <span class="filter-label">–°–∞–π—Ç</span>
        <div class="select-wrapper" id="siteDropdownWrap">
          <button class="site-dropdown-btn" id="siteDropdownBtn" onclick="toggleSiteDropdown(event)">
            <span id="siteDropdownLabel">–í—Å–µ —Å–∞–π—Ç—ã</span>
            <span style="margin-left:8px;font-size:10px;color:var(--gray);">‚ñæ</span>
          </button>
          <div class="site-dropdown-menu" id="siteDropdownMenu" style="display:none;">
            <div class="site-option" onclick="toggleSite('pravo','PRAVO.GOV.RU')">PRAVO.GOV.RU</div>
            <div class="site-option" onclick="toggleSite('nalog','NALOG.GOV.RU')">NALOG.GOV.RU</div>
            <div class="site-option" onclick="toggleSite('cbr','CBR.RU')">CBR.RU</div>
            <div class="site-option" onclick="toggleSite('consultant','CONSULTANT.RU')">CONSULTANT.RU</div>
            <div class="site-option" onclick="toggleSite('rg','RG.RU')">RG.RU</div>
            <div class="site-option" onclick="toggleSite('my','–ú–æ–∏')">–ú–æ–∏</div>
            <div class="site-option" onclick="toggleSite('urgent','–°—Ä–æ—á–Ω—ã–µ')">–°—Ä–æ—á–Ω—ã–µ</div>
          </div>
        </div>
      </div>

      <div class="bar-divider"></div>

      <!-- –ü–æ—Ä—è–¥–æ–∫ -->
      <div class="filter-group">
        <span class="filter-label">–ü–æ—Ä—è–¥–æ–∫</span>
        <div class="sort-toggle">
          <button class="sort-btn active" id="btnNew" onclick="setSortOrder('new')">
            <span>‚Üë</span> –ù–æ–≤—ã–µ
          </button>
          <button class="sort-btn" id="btnOld" onclick="setSortOrder('old')">
            <span>‚Üì</span> –°—Ç–∞—Ä—ã–µ
          </button>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤—ã–µ –∫–Ω–æ–ø–∫–∏ -->
      <div class="bar-actions">
        <button class="btn-refresh" onclick="loadAll()" id="refreshBtn">
          <span id="refreshIcon">‚Üª</span> –û–±–Ω–æ–≤–∏—Ç—å
        </button>
        <button class="btn-parse" onclick="triggerParse()" id="parseBtn">
          –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥
        </button>
      </div>

    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (pills) -->
    <div class="active-filters" id="pills"></div>
  </div>

  <!-- DOCUMENTS -->
  <div class="docs-section">
    <div class="docs-header">
      <span class="docs-title">–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</span>
      <span class="docs-count" id="docsCount">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    <div class="doc-list" id="docList">
      <!-- skeletons -->
      <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
      <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
      <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
      <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
      <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
    </div>
    <div class="load-more-wrap" id="loadMoreWrap" style="display:none">
      <button class="btn-load-more" id="loadMoreBtn" onclick="loadMore()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
    </div>
  </div>

</div>

<!-- FOOTER -->
<footer>
  <div class="footer-logo">
    <span class="logo-dot"></span>
    ComplianceRadar ¬∑ 2026
  </div>
  <div class="footer-links">
    <a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
    <a href="#">–î–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã</a>
    <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
  </div>
  <div class="footer-copy">¬© 2026 ComplianceRadar. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
</footer>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
  const API = 'https://fnsbot-production.up.railway.app';
  const CR_TOKEN = localStorage.getItem('cr_token');
  const CR_USER = JSON.parse(localStorage.getItem('cr_user') || 'null');
  let showPersonal = false; // –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ ¬´–ú–æ–∏¬ª –≤ —Ñ–∏–ª—å—Ç—Ä–µ
  let currentFilter = 'all';
  let currentOffset = 0;
  const PAGE_SIZE = 20;
  let totalDocs = 0;

  // ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function showToast(msg, type = '') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast show ' + type;
    setTimeout(() => { t.className = 'toast'; }, 4000);
  }

  function formatDate(iso) {
    if (!iso) return '‚Äî';
    const d = new Date(iso);
    return d.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' });
  }

  function setStatus(online) {
    const dot = document.getElementById('statusDot');
    const txt = document.getElementById('statusText');
    if (online) {
      dot.className = 'status-dot online';
      txt.textContent = 'API –æ–Ω–ª–∞–π–Ω';
      txt.style.color = 'var(--green)';
    } else {
      dot.className = 'status-dot error';
      txt.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
      txt.style.color = 'var(--accent)';
    }
  }

  // ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  async function loadStats() {
    try {
      const res = await fetch(`${API}/stats`);
      if (!res.ok) throw new Error();
      const data = await res.json();
      setStatus(true);

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∏—Å–ª–∞
      const fields = [
        ['skTotal', 'statTotal', data.documents.total],
        ['skProcessed', 'statProcessed', data.documents.processed],
        ['skUrgent', 'statUrgent', data.documents.urgent],
        ['skSubs', 'statSubs', data.subscribers],
      ];

      fields.forEach(([skId, valId, val]) => {
        document.getElementById(skId).style.display = 'none';
        const el = document.getElementById(valId);
        el.textContent = val ?? '0';
        el.style.display = 'block';
      });

      // –°—Ä–æ—á–Ω—ã–µ ‚Äî –∫—Ä–∞—Å–Ω—ã–º
      document.getElementById('statUrgent').style.color = 'var(--accent)';

      // –ò—Å—Ç–æ—á–Ω–∏–∫–∏
      const s = data.sources || {};
      document.getElementById('srcPravo').textContent = s['pravo.gov.ru'] ?? 0;
      document.getElementById('srcNalog').textContent = s['nalog.gov.ru'] ?? 0;
      document.getElementById('srcCbr').textContent = s['cbr.ru'] ?? 0;

    } catch (e) {
      setStatus(false);
      ['skTotal','skProcessed','skUrgent','skSubs'].forEach(id => {
        const sk = document.getElementById(id);
        sk.style.background = 'rgba(200,57,43,0.08)';
      });
    }
  }

  // ‚îÄ‚îÄ DOCUMENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  // –ú–∞–ø–ø–∏–Ω–≥ val -> source param
  const SOURCE_MAP = {
    pravo: 'pravo.gov.ru', nalog: 'nalog.gov.ru', cbr: 'cbr.ru',
    consultant: 'consultant.ru', rg: 'rg.ru'
  };

  function buildParams(offset = 0) {
    const params = new URLSearchParams({ limit: PAGE_SIZE, offset });
    params.set('order', currentSortOrder === 'old' ? 'asc' : 'desc');

    const hasUrgent = selectedSites.some(s => s.val === 'urgent');
    if (hasUrgent) { params.set('urgency', 'true'); return params.toString(); }

    // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)
    const sources = selectedSites
      .filter(s => SOURCE_MAP[s.val])
      .map(s => SOURCE_MAP[s.val]);
    if (sources.length === 1) params.set('source', sources[0]);
    // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Äî API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, —Ñ–∏–ª—å—Ç—Ä—É–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (—Å–º. loadDocs)

    return params.toString();
  }

  function getDocsUrl(offset) {
    const hasMy = selectedSites.some(s => s.val === 'my');
    if (hasMy && CR_TOKEN) {
      return `${API}/documents/my?limit=${PAGE_SIZE}&offset=${offset}`;
    }
    return `${API}/documents?${buildParams(offset)}`;
  }

  function renderDoc(doc, index) {
    const tags = (doc.tags || []).slice(0, 5);
    const tagsHtml = tags.length
      ? `<div class="doc-tags">${tags.map(t => `<span class="doc-tag">${t}</span>`).join('')}</div>`
      : '';

    const urgentBadge = doc.urgency
      ? `<span class="doc-urgent">–°—Ä–æ—á–Ω–æ</span>`
      : '';

    const summary = doc.summary
      ? `<p class="doc-summary">${doc.summary}</p>`
      : `<p class="doc-summary" style="opacity:0.35;font-style:italic;">–ê–Ω–∞–ª–∏–∑ –ò–ò –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...</p>`;

    // –î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É
    let effDateHtml = '';
    if (doc.effective_date) {
      const effD = new Date(doc.effective_date);
      const diffDays = Math.ceil((effD - new Date()) / 86400000);
      const effFmt = effD.toLocaleDateString('ru-RU', {day:'2-digit',month:'2-digit',year:'numeric'});
      const soonClass = (diffDays >= 0 && diffDays <= 30) ? ' soon' : '';
      effDateHtml = `<span class="doc-eff-date${soonClass}">${effFmt}</span>`;
    }

    return `
      <div class="doc-card">
        <span class="doc-index">${String(index).padStart(2, '0')}</span>
        <div class="doc-body">
          <div class="doc-meta">
            <span class="doc-source">${doc.source}</span>
            <span class="doc-date">${formatDate(doc.published_at)}</span>
            ${urgentBadge}
          ${effDateHtml}
          </div>
          <h3 class="doc-title">${doc.title}</h3>
          ${summary}
          ${tagsHtml}
        </div>
        <a class="doc-link" href="${doc.url}" target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å ‚Üí</a>
      </div>
    `;
  }

  async function loadDocs(reset = true) {
    if (reset) {
      currentOffset = 0;
      document.getElementById('docList').innerHTML = `
        <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
        <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
        <div class="doc-skeleton"><div class="sk-line sk-title"></div><div class="sk-line sk-summary"></div><div class="sk-line sk-summary2"></div></div>
      `;
    }

    try {
      const headers = CR_TOKEN ? { 'Authorization': `Bearer ${CR_TOKEN}` } : {};
      const res = await fetch(getDocsUrl(currentOffset), { headers });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      totalDocs = data.total;
      const docs = data.documents || [];

      if (reset) document.getElementById('docList').innerHTML = '';

      document.getElementById('docsCount').textContent = `${totalDocs} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤`;

      if (docs.length === 0 && reset) {
        document.getElementById('docList').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚Äî</div>
            <div class="empty-title">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
            <div class="empty-sub">–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
          </div>
        `;
      } else {
        const list = document.getElementById('docList');
        docs.forEach((doc, i) => {
          list.insertAdjacentHTML('beforeend', renderDoc(doc, currentOffset + i + 1));
        });
        currentOffset += docs.length;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–∑–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë"
      const loadMoreWrap = document.getElementById('loadMoreWrap');
      if (currentOffset < totalDocs) {
        loadMoreWrap.style.display = 'flex';
        document.getElementById('loadMoreBtn').disabled = false;
      } else {
        loadMoreWrap.style.display = 'none';
      }

    } catch (e) {
      document.getElementById('docsCount').textContent = '–æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
      if (reset) {
        document.getElementById('docList').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">!</div>
            <div class="empty-title">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</div>
            <div class="empty-sub">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –Ω–∞ Railway.</div>
          </div>
        `;
      }
    }
  }

  async function loadMore() {
    const btn = document.getElementById('loadMoreBtn');
    btn.disabled = true;
    btn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
    await loadDocs(false);
    btn.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë';
  }

  async function loadAll() {
    const icon = document.getElementById('refreshIcon');
    icon.classList.add('spin');
    await Promise.all([loadStats(), loadDocs(true)]);
    icon.classList.remove('spin');
  }

  // ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  let currentSortOrder = 'new';
  let selectedSites = []; // –º–∞—Å—Å–∏–≤ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ [{val, label}]

  // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
  document.addEventListener('click', function(e) {
    const wrap = document.getElementById('siteDropdownWrap');
    if (wrap && !wrap.contains(e.target)) {
      document.getElementById('siteDropdownMenu').style.display = 'none';
    }
  });

  function toggleSiteDropdown(e) {
    e.stopPropagation();
    const menu = document.getElementById('siteDropdownMenu');
    menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
  }

  function toggleSite(val, label) {
    const idx = selectedSites.findIndex(s => s.val === val);
    if (idx === -1) {
      // –û—Å–æ–±—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
      if (val === 'my' || val === 'urgent') {
        selectedSites = [{val, label}];
      } else {
        // –£–±–∏—Ä–∞–µ–º my/urgent –µ—Å–ª–∏ –±—ã–ª–∏
        selectedSites = selectedSites.filter(s => s.val !== 'my' && s.val !== 'urgent');
        selectedSites.push({val, label});
      }
    } else {
      selectedSites.splice(idx, 1);
    }
    updateDropdownUI();
    updatePills();
    loadDocs(true);
  }

  function removeSite(val) {
    selectedSites = selectedSites.filter(s => s.val !== val);
    updateDropdownUI();
    updatePills();
    loadDocs(true);
  }

  function updateDropdownUI() {
    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–∞–ª–æ—á–∫–∏ –≤ –º–µ–Ω—é
    document.querySelectorAll('.site-option').forEach(el => {
      const onclick = el.getAttribute('onclick');
      const match = onclick && onclick.match(/toggleSite\('([^']+)'/);
      if (match) {
        el.classList.toggle('selected', selectedSites.some(s => s.val === match[1]));
      }
    });
    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–π–±–ª –∫–Ω–æ–ø–∫–∏
    const btn = document.getElementById('siteDropdownLabel');
    btn.textContent = selectedSites.length === 0 ? '–í—Å–µ —Å–∞–π—Ç—ã'
      : selectedSites.length === 1 ? selectedSites[0].label
      : `${selectedSites.length} —Å–∞–π—Ç–∞`;
  }

  function setSortOrder(val) {
    currentSortOrder = val;
    document.getElementById('btnNew').classList.toggle('active', val === 'new');
    document.getElementById('btnOld').classList.toggle('active', val === 'old');
    updatePills();
    loadDocs(true);
  }

  function updatePills() {
    const pills = document.getElementById('pills');
    pills.innerHTML = '';
    selectedSites.forEach(s => {
      pills.appendChild(makePill(s.label, () => removeSite(s.val)));
    });
    if (currentSortOrder !== 'new') {
      pills.appendChild(makePill('‚Üì –°—Ç–∞—Ä—ã–µ', () => setSortOrder('new')));
    }
  }

  function makePill(label, onRemove) {
    const d = document.createElement('div');
    d.className = 'pill';
    d.innerHTML = `${label} <span class="pill-x">‚úï</span>`;
    d.querySelector('.pill-x').onclick = onRemove;
    return d;
  }

  // ‚îÄ‚îÄ FILTER (legacy) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function setPersonal(btn) { /* legacy ‚Äî handled by select */ }
  function setFilter(filter, btn) { /* legacy ‚Äî handled by select */ }

  // ‚îÄ‚îÄ PARSE TRIGGER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  async function triggerParse() {
    const btn = document.getElementById('parseBtn');
    btn.disabled = true;
    btn.textContent = '–ó–∞–ø—É—Å–∫–∞–µ–º...';

    try {
      const res = await fetch(`${API}/admin/parse-now`, { method: 'POST' });
      if (!res.ok) throw new Error();
      showToast('–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–µ. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1‚Äì2 –º–∏–Ω—É—Ç—ã.', 'success');
    } catch (e) {
      showToast('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API.', 'error');
    } finally {
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥';
      }, 3000);
    }
  }

  // ‚îÄ‚îÄ BURGER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  const burger = document.getElementById('burger');
  const mobileMenu = document.getElementById('mobileMenu');
  burger.addEventListener('click', () => {
    burger.classList.toggle('open');
    mobileMenu.classList.toggle('open');
    document.body.style.overflow = mobileMenu.classList.contains('open') ? 'hidden' : '';
  });
  mobileMenu.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      burger.classList.remove('open');
      mobileMenu.classList.remove('open');
      document.body.style.overflow = '';
    });
  });

  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  if (CR_USER) {
    const panel = document.getElementById('userPanel');
    if (panel) {
      panel.style.display = 'flex';
      document.getElementById('userName').textContent = CR_USER.name || CR_USER.email;
    }
  }

  function logout() {
    fetch(`${API}/auth/logout`, { method: 'POST', headers: CR_TOKEN ? { 'Authorization': `Bearer ${CR_TOKEN}` } : {} }).catch(()=>{});
    localStorage.removeItem('cr_token');
    localStorage.removeItem('cr_user');
    window.location.href = 'login.html';
  }


  // ‚îÄ‚îÄ –ê–í–¢–û–§–ò–õ–¨–¢–† –ü–û –û–¢–†–ê–°–õ–ò –ü–û–°–õ–ï –û–ù–ë–û–†–î–ò–ù–ì–ê ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const INDUSTRY_SOURCE_MAP = {
    bank: 'cbr', insurance: 'cbr', telecom: 'nalog',
    retail: 'nalog', pharma: 'nalog', construction: 'nalog',
    energy: 'nalog', manufacturing: 'nalog'
  };

  function applyIndustryFromUrl() {
    const params = new URLSearchParams(window.location.search);
    const industry = params.get('industry');
    if (!industry) return;

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ—Å—Ç
    setTimeout(() => showToast(`‚úì –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–¥ –≤–∞—à—É –æ—Ç—Ä–∞—Å–ª—å`, 'success'), 500);

    // –ü—Ä–µ–¥–≤—ã–±–∏—Ä–∞–µ–º "–ú–æ–∏" –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–∫–µ–Ω, –∏–Ω–∞—á–µ –Ω–∏—á–µ–≥–æ
    if (CR_TOKEN) {
      selectedSites = [{val: 'my', label: '–ú–æ–∏'}];
      updateDropdownUI();
      updatePills();
    }
  }


  // ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  let searchQuery = '';
  let allLoadedDocs = []; // –∫—ç—à –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

  document.getElementById('searchInput').addEventListener('input', function() {
    searchQuery = this.value.trim().toLowerCase();
    filterDocsLocal();
  });

  // –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ / 
  document.addEventListener('keydown', function(e) {
    if (e.key === '/' && document.activeElement !== document.getElementById('searchInput')) {
      e.preventDefault();
      document.getElementById('searchInput').focus();
    }
    if (e.key === 'Escape') {
      document.getElementById('searchInput').value = '';
      searchQuery = '';
      filterDocsLocal();
    }
  });

  function filterDocsLocal() {
    const cards = document.querySelectorAll('#docList .doc-card');
    let visible = 0;
    cards.forEach(card => {
      if (!searchQuery) {
        card.style.display = '';
        visible++;
        return;
      }
      const text = card.innerText.toLowerCase();
      if (text.includes(searchQuery)) {
        card.style.display = '';
        visible++;
      } else {
        card.style.display = 'none';
      }
    });
    const cnt = document.getElementById('searchResultsCount');
    if (searchQuery && cards.length > 0) {
      cnt.textContent = `–ù–∞–π–¥–µ–Ω–æ: ${visible} –∏–∑ ${cards.length}`;
    } else {
      cnt.textContent = '';
    }
  }

  // ‚îÄ‚îÄ INDUSTRY FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  const INDUSTRY_KEYWORDS = {
    tax:          ['–Ω–∞–ª–æ–≥', '–Ω–¥—Å', '–Ω–¥—Ñ–ª', '—Ñ–Ω—Å', '–±—É—Ö—É—á—ë—Ç', '–±—É—Ö–≥–∞–ª—Ç–µ—Ä', '–º–∏—Ñ–Ω—Å', '—É—Å–Ω', '–ø–∞—Ç–µ–Ω—Ç', '–≤–∑–Ω–æ—Å', '–ø—Ä–∏–±—ã–ª—å', '–∏–º—É—â–µ—Å—Ç–≤–æ', '–∞–∫—Ü–∏–∑'],
    bank:         ['–±–∞–Ω–∫', '—Ü–± ', '–∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞', '–∫—Ä–µ–¥–∏—Ç', '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω', '–ª–∏—Ü–µ–Ω–∑–∏', '–º–∏–∫—Ä–æ—Ñ–∏–Ω–∞–Ω—Å', '–Ω–æ—Ä–º–∞—Ç–∏–≤—ã', '—Ä–µ–∑–µ—Ä–≤', '–∫–∞–ø–∏—Ç–∞–ª'],
    it:           ['–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω', '152-—Ñ–∑', '—Ä–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä', '–¥–∞–Ω–Ω—ã–µ', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω', '—Ü–∏—Ñ—Ä–æ–≤–æ–π', '–ø—Ä–æ–≥—Ä–∞–º–º–Ω', '–∫–∏–∏', '–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏', '–ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω'],
    labor:        ['—Ç—Ä—É–¥', '—Ç—Ä—É–¥–æ–≤–æ–π', '–º—Ä–æ—Ç', '–∑–∞—Ä–ø–ª–∞—Ç', '–æ—Ç–ø—É—Å–∫', '–æ—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞', '–º–∏–Ω—Ç—Ä—É–¥', '–∑–∞–Ω—è—Ç–æ—Å—Ç', '–∫–∞–¥—Ä', '—É–≤–æ–ª—å–Ω–µ–Ω'],
    trade:        ['—Ç–æ—Ä–≥–æ–≤–ª', '—Ä–æ–∑–Ω–∏—á–Ω', '—Ä–∏—Ç–µ–π–ª', '–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å', '—Ä–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä', '—Å–∞–Ω–ø–∏–Ω', '–º–∞—Ä–∫–∏—Ä–æ–≤–∫', '—á–µ—Å—Ç–Ω—ã–π –∑–Ω–∞–∫'],
    construction: ['—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤', '–æ–±—ä–µ–∫—Ç', '–≥—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç', '–∂–∫—Ö', '—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏', '–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç', '–∫–∞–¥–∞—Å—Ç—Ä'],
    pharma:       ['–º–µ–¥–∏—Ü–∏–Ω', '—Ñ–∞—Ä–º–∞—Ü–µ–≤—Ç', '–ª–µ–∫–∞—Ä—Å—Ç–≤', '–∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω', '—Å–∞–Ω–∏—Ç–∞—Ä–Ω', '—Ä–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä'],
  };

  let currentIndustry = 'all';

  function setIndustry(industry, btn) {
    currentIndustry = industry;
    document.querySelectorAll('.industry-btn-ui').forEach(b => b.classList.remove('active'));
    if (btn) btn.classList.add('active');
    filterDocsByIndustry();
  }

  function resetIndustry() {
    setIndustry('all', document.querySelector('[data-industry="all"]'));
  }

  function filterDocsByIndustry() {
    const cards = document.querySelectorAll('#docList .doc-card');
    let counts = { all: 0, tax: 0, bank: 0, it: 0, labor: 0, trade: 0, construction: 0, pharma: 0 };

    cards.forEach(card => {
      const text = card.innerText.toLowerCase();
      counts.all++;

      let matchIndustry = currentIndustry === 'all';

      Object.entries(INDUSTRY_KEYWORDS).forEach(([ind, kws]) => {
        if (kws.some(kw => text.includes(kw))) {
          counts[ind] = (counts[ind] || 0) + 1;
          if (ind === currentIndustry) matchIndustry = true;
        }
      });

      card.style.display = matchIndustry ? '' : 'none';
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫–∏
    document.getElementById('indCountAll').textContent = counts.all || 0;
    document.getElementById('indCountTax').textContent = counts.tax || 0;
    document.getElementById('indCountBank').textContent = counts.bank || 0;
    document.getElementById('indCountIt').textContent = counts.it || 0;
    document.getElementById('indCountLabor').textContent = counts.labor || 0;
    document.getElementById('indCountTrade').textContent = counts.trade || 0;
    document.getElementById('indCountConst').textContent = counts.construction || 0;
    document.getElementById('indCountPharma').textContent = counts.pharma || 0;
  }

  // –ü–∞—Ç—á: –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
  const _origLoadAll = loadAll;
  async function loadAll() {
    await _origLoadAll();
    filterDocsByIndustry();
    filterDocsLocal();
    buildCalendar();
    buildUpcoming();
  }
  const _origLoadMore = loadMore;
  async function loadMore() {
    await _origLoadMore();
    filterDocsByIndustry();
    filterDocsLocal();
    buildCalendar();
    buildUpcoming();
  }

  // ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  const MONTHS_RU = ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å',
                     '–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'];
  const MONTHS_RU_GEN = ['—è–Ω–≤–∞—Ä—è','—Ñ–µ–≤—Ä–∞–ª—è','–º–∞—Ä—Ç–∞','–∞–ø—Ä–µ–ª—è','–º–∞—è','–∏—é–Ω—è',
                          '–∏—é–ª—è','–∞–≤–≥—É—Å—Ç–∞','—Å–µ–Ω—Ç—è–±—Ä—è','–æ–∫—Ç—è–±—Ä—è','–Ω–æ—è–±—Ä—è','–¥–µ–∫–∞–±—Ä—è'];

  let calYear, calMonth;

  function initCal() {
    const now = new Date();
    calYear = now.getFullYear();
    calMonth = now.getMonth();
  }

  function calPrev() { calMonth--; if (calMonth < 0) { calMonth = 11; calYear--; } buildCalendar(); }
  function calNext() { calMonth++; if (calMonth > 11) { calMonth = 0; calYear++; } buildCalendar(); }

  function buildCalendar() {
    document.getElementById('calMonthLabel').textContent = `${MONTHS_RU[calMonth]} ${calYear}`;

    const grid = document.getElementById('calGrid');
    const dayNames = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'];
    let html = dayNames.map(d => `<div class="cal-day-name-ui">${d}</div>`).join('');

    const firstDay = new Date(calYear, calMonth, 1).getDay(); // 0=Sun
    const emptyStart = (firstDay === 0) ? 6 : firstDay - 1;
    const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();
    const today = new Date();

    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ DOM
    const eventDates = {};
    document.querySelectorAll('#docList .doc-card').forEach(card => {
      const efEl = card.querySelector('.doc-eff-date');
      if (efEl) {
        const txt = efEl.textContent.trim();
        const m = txt.match(/(\d{2})\.(\d{2})\.(\d{4})/);
        if (m) {
          const key = `${m[3]}-${m[2]}-${m[1]}`;
          const isUrgent = efEl.classList.contains('soon');
          eventDates[key] = isUrgent ? 'urgent' : 'event';
        }
      }
    });

    for (let i = 0; i < emptyStart; i++) html += `<div class="cal-day-ui empty"></div>`;

    for (let d = 1; d <= daysInMonth; d++) {
      const key = `${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const isToday = (d === today.getDate() && calMonth === today.getMonth() && calYear === today.getFullYear());
      let cls = 'cal-day-ui';
      if (isToday) cls += ' today';
      if (eventDates[key] === 'urgent') cls += ' has-urgent';
      else if (eventDates[key] === 'event') cls += ' has-event';
      html += `<div class="${cls}">${d}</div>`;
    }

    grid.innerHTML = html;
  }

  // ‚îÄ‚îÄ UPCOMING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function buildUpcoming() {
    const items = [];
    const today = new Date();

    document.querySelectorAll('#docList .doc-card').forEach(card => {
      const efEl = card.querySelector('.doc-eff-date');
      if (!efEl) return;
      const txt = efEl.textContent.trim();
      const m = txt.match(/(\d{2})\.(\d{2})\.(\d{4})/);
      if (!m) return;
      const date = new Date(+m[3], +m[2]-1, +m[1]);
      if (date < today) return;
      const titleEl = card.querySelector('.doc-title');
      const sourceEl = card.querySelector('.doc-source');
      items.push({
        date,
        day: m[1],
        month: MONTHS_RU_GEN[+m[2]-1],
        title: titleEl ? titleEl.textContent.trim().substring(0, 80) + (titleEl.textContent.length > 80 ? '‚Ä¶' : '') : '',
        source: sourceEl ? sourceEl.textContent.trim() : '',
        isUrgent: efEl.classList.contains('soon'),
      });
    });

    items.sort((a, b) => a.date - b.date);
    const top = items.slice(0, 5);

    const list = document.getElementById('upcomingList');
    if (top.length === 0) {
      list.innerHTML = '<div class="upcoming-empty">–ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –¥–∞—Ç–æ–π –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É</div>';
      return;
    }

    list.innerHTML = top.map(it => `
      <div class="upcoming-item-ui">
        <div class="upcoming-date-ui">
          <span class="ud-day${it.isUrgent ? ' urgent' : ''}">${it.day}</span>
          <span class="ud-month">${it.month}</span>
        </div>
        <div class="upcoming-info-ui">
          <div class="upcoming-title-ui">${it.title}</div>
          <div class="upcoming-source-ui">${it.source}</div>
        </div>
      </div>
    `).join('');
  }

  initCal();
  buildCalendar();

  applyIndustryFromUrl();
  loadAll();

  // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
  setInterval(loadStats, 120000);
</script>
</body>
</html>
